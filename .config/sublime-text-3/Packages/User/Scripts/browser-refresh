#!/bin/bash

# set target browser and title
browser='Chromium'
title=''

# browser we would like to live reload
reload_browser_id=$(

  comm -12 <(xdotool search --name  $title  | sort) <(xdotool search --class $browser  | sort)

); # named pipe comparison comm -12 /dev/fd/63 /dev/fd/63. See  https://unix.stackexchange.com/questions/254820/xdotool-how-to-search-for-window-by-title-and-class-with-different-patterns-si

# active window where the script was activated
active_window_id=$(xdotool getwindowfocus)

# echo target browser id for debugging purposes
echo $reload_browser_id;

# bail on empty window id
if [ -z $reload_browser_id ]; then
  notify-send "No match for browser $browser with title $title!";
  exit;
fi

# activate target browser
xdotool windowactivate $reload_browser_id;

# declare the variable i as an interger
declare -i i=0;

while true; do
    
    # set index i to increment by 1
    i+=1
    
    # get target browser window
    focused_browser_id=$(xdotool getwindowfocus);

    if [ "$reload_browser_id" -eq "$focused_browser_id" ]; then

      xdotool key "ctrl+r";

      # echo received browser id for debugging purposes
      echo $reload_browser_id;

      break;

    # bail out if there are too many iterations
    elif [ "$i" -gt 20 ]; then

      notify-send "No match for browser $browser with title $title!";

      break;

    fi

    # echo the amount of interations for debugging purposes
    echo "Iteration: $i";

done

xdotool windowactivate $active_window_id;
